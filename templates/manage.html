<!DOCTYPE html>
<html>
	<head>
		<title>管理端</title>
		<meta charset="utf-8">
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- Favicon -->

		<!-- bootstrap CSS -->
		<link rel="stylesheet" href="../static/css/bootstrap.min.css" type="text/css" media="all">
		<!-- carousel CSS -->
		<link rel="stylesheet" href="../static/css/owl.carousel.min.css" type="text/css" media="all">
		<!-- animate CSS -->
		<link rel="stylesheet" href="../static/css/animate.css" type="text/css" media="all">
		<!-- animated-text CSS -->
		<link rel="stylesheet" href="../static/css/animated-text.css" type="text/css" media="all">
		<!-- font-awesome CSS -->
		<link rel="stylesheet" href="../static/css/all.min.css" type="text/css" media="all">
		<!-- font-flaticon CSS -->
		<link rel="stylesheet" href="../static/css/flaticon.css" type="text/css" media="all">
		<!-- theme-default CSS -->
		<link rel="stylesheet" href="../static/css/theme-default.css" type="text/css" media="all">
		<!-- meanmenu CSS -->
		<link rel="stylesheet" href="../static/css/meanmenu.min.css" type="text/css" media="all">
		<!-- transitions CSS -->
		<link rel="stylesheet" href="../static/css/owl.transitions.css" type="text/css" media="all">
		<!-- venobox CSS -->
		<link rel="stylesheet" href="../static/css/venobox.css" type="text/css" media="all">
		<!-- bootstrap icons -->
		<link rel="stylesheet" href="../static/css/bootstrap-icons.css" type="text/css" media="all">
		<!-- Main Style CSS -->
		<link rel="stylesheet" href="../static/css/style.css" type="text/css" media="all">
		<!-- responsive CSS -->
		<link rel="stylesheet" href="../static/css/responsive.css" type="text/css" media="all">
		<!-- modernizr js -->
		<script src="../static/js/modernizr-3.5.0.min.js"></script>
		<link href="https://cdn.staticfile.org/twitter-bootstrap/5.1.1/css/bootstrap.min.css" rel="stylesheet">
		<script src="https://cdn.staticfile.org/twitter-bootstrap/5.1.1/js/bootstrap.bundle.min.js"></script>
		<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
		<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
		<script src="https://code.highcharts.com/highcharts.js"></script>
		<link rel="stylesheet" href="https://cdn.staticfile.org/foundation/5.5.3/css/foundation.min.css">
		<script src="https://cdn.staticfile.org/foundation/5.5.3/js/foundation.min.js"></script>
		<script src="https://cdn.staticfile.org/foundation/5.5.3/js/vendor/modernizr.js"></script>
	</head>
	<style>
		.juzhong {
			position: absolute;
			left: 40%;
			top: 50%;
			transform: translate(-50%, -50%);
		}
		.juzhong1 {
			position: absolute;
			left: 50%;
			top: 50%;
			transform: translate(-50%, -50%);
		}
		.th1 {
			width: 150px;
			height:60px;
		  }
	</style>
	<body>

		<div class="container mt-0 mx-0">
			<nav class="navbar navbar-expand-sm bg-light navbar-dark fixed-top">
				<a class="navbar-brand" href="#">
					<img src="../static/picture/logo1.png" alt="logo">
				</a>
				<!-- Nav pills -->
				<ul class="nav nav-pills" role="tablist">
					<li class="nav-item">
						<a class="nav-link active" data-bs-toggle="pill" href="#home">网站数据可视化分析</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" data-bs-toggle="pill" href="#menu1">用户模块</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" data-bs-toggle="pill" href="#menu5">简历文件模块</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" data-bs-toggle="pill" href="#menu6">岗位信息模块</a>
					</li>
				</ul>
				<button type="button" class="btn btn-primary" style="position:absolute;top:30px;right:30px"
					id="exit">退出</button>
			</nav>
			<!-- Tab panes -->
			<div class="tab-content">
				<div id="home" class="container tab-pane active"><br>
					<br><br>
					<h3>网站数据可视化分析</h3>
					<div class="row">
						<div class="col-lg-4 col-md-6">
							<!--service single box-->
							<div class="service-single-box">
								<div class="service-icon">
									<img src="../static/picture/service1.png" alt="icon">
								</div>
								<!--service box content-->
								<div class="service-box-content">
									<div class="service-title">
										<h3>新增用户</h3>
									</div>
									<div class="service-description">
										<p>300</p>
									</div>
								</div>
							</div>
						</div>
						<div class="col-lg-4 col-md-6">
							<!--service single box-->
							<div class="service-single-box">
								<div class="service-icon">
									<img src="../static/picture/service2.png" alt="icon">
								</div>
								<!--service box content-->
								<div class="service-box-content">
									<div class="service-title">
										<h3>新增简历</h3>
									</div>
									<div class="service-description">
										<p>78</p>
									</div>
								</div>
							</div>
						</div>
						<div class="col-lg-4 col-md-6">
							<!--service single box-->
							<div class="service-single-box">
								<div class="service-icon">
									<img src="../static/picture/service3.png" alt="icon">
								</div>
								<!--service box content-->
								<div class="service-box-content">
									<div class="service-title">
										<h3>新增岗位</h3>
									</div>
									<div class="service-description">
										<p>23</p>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div id="chartContainer"></div>
					<div id="chartContainer2"></div>
					<div id="chartContainer3"></div>
				</div>
				<div id="menu1" class="container tab-pane fade"><br>
					<div class="responsive juzhong">
						<br><br><br><br>
						<table>
							<thead>
								<tr>
									<th class="th1">编号</th>
									<th class="th1">用户名</th>
									<th class="th1">身份</th>
									<th class="th1">IP地址</th>
									<th class="th1">创建时间</th>
									<th class="th1">上次登录时间</th>
									<th class="th1">是否禁用</th>
									<th class="th1">是否在线</th>
								</tr>
							</thead>
							<tbody id="wrap">

							</tbody>
						</table>
					</div>
				</div>
				<div id="menu5" class="container tab-pane fade"><br>
					<br><br>
					<h3>简历文件模块</h3>
					<div class="responsive juzhong1">
						<table>
							<thead>
								<tr>
									<th>编号</th>
									<th>文件名</th>
									<th>路径</th>
									<th>文件类型</th>
								</tr>
							</thead>
							<tbody id="box">

							</tbody>
						</table>
					</div>
				</div>
				<div id="menu6" class="container tab-pane fade"><br>
					<br><br><br><br>
					<h3>岗位信息模块</h3>
					<div class="responsive">
						<table>
							<thead>
								<tr>
									<th class="th1">编号</th>
									<th class="th1">岗位名称</th>
									<th>岗位职责</th>
									<th>岗位要求</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>1</td>
									<td>产品运营</td>
									<td>1.负责产品上线前后的线上、线下的运营方案和推广工作，协助项目负责人对接市场、产品开发等，完成个项目目标；
										2.负责产品运营中与线下的各种合作，配合完成商务推广，实施项目评估和监控，提升用户活跃度和忠诚度；
										3.负责研究行业竞争动态，定期拜访客户，维护重要客户关系发现客户的需求，引导客户的业务需求，根据自身产品制定产品营销策略，达成既定目标；
										4.负责分析和挖掘产品运营数据、用户行为数据等重要价值信息
										5.负责跟进和整理产品用户反馈，协同产品经理提出产品迭代方案。</td>
									<td>1.2年及以上产品运营经验；
										2.主动性强，逻辑清晰，沟通能力强，能独立负责和落地运营项目能调动资源为运营目标服务；
										3.有较强数据分析能力、数据敏感性强。</td>
								</tr>
								<tr>
									<td>2</td>
									<td>平面设计师</td>
									<td>1.负责公司公众号的维护和内容推送；
										2.短视频相关内容的文案脚本策划，视频制作及编辑。并结合公司宣传计划，不断优化视频内容；
										3.协助其他平面设计、视频编辑等内容。</td>
									<td>1.大专及以上学历，1-2年相关工作经验；
										2.熟悉平面设计软件及视频剪辑等，设计感好；
										3.工作责任心强，沟通及理解能力强。</td>
								</tr>
								<tr>
									<td>3</td>
									<td>财务</td>
									<td>1.全面负责财务部的日常管理工作；
										2.组织制定财务方面的管理制度及有关规定，并监督执行；
										3.向公司提供各项财务报告和必要的财务分析；
										4.监控可能会对公司造成经济损失的重大经济合同；
										5.有独立处理账务和税务的能力者优先；
										6.有全盘账务处理，税务工作，年度汇算清缴能力者优先；
										7.公司资质和合同的归档保管工作；
										8.完成上级领导交代的其他日常工作任务。</td>
									<td>1.本科及以上学历；
										2.通晓财会专业知识，熟悉国家有关财务、会计、税收政策和实务；
										3.有互联网行业相关经验优先；
										4.原则性强，沟通能力佳，有良好的团队协作意识。</td>
								</tr>
								<tr>
									<td>4</td>
									<td>市场营销</td>
									<td>1.根据公司发展方向及阶段性目标，制定品牌战略、推广策略等年度经营方案；
										2.参与各产品推广筹划方案的制定与执行；
										3.负责企业整体形象的定位与维护，建立完整的产品口碑营销方案及公司形象推广方案；
										4.负责与新媒体及知名媒体进行沟通，开展长期良好合作；
										5.负责制作与推广公司各类宣传资料，完善对外各类宣传通稿；
										6.负责为公司的知识产权、荣誉资质等进行申请、维护与宣传。</td>
									<td>1.熟练使用办公软件，可以独立制作表格、PPT等；
										2.良好的沟通能力，善于维护客户关系；
										3.有拓展、策划经验能力者优先考虑。
										4.本科以上
										5.10年以上相关工作经验</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
		<!-- jquery js -->
		<script src="../static/js/jquery-3.6.2.min.js"></script>
		<script src="../static/js/popper.min.js"></script>
		<!-- bootstrap js -->
		<script src="../static/js/bootstrap.min.js"></script>
		<!-- carousel js -->
		<script src="../static/js/owl.carousel.min.js"></script>
		<!-- counterup js -->
		<script src="../static/js/jquery.counterup.min.js"></script>
		<!-- waypoints js -->
		<script src="../static/js/waypoints.min.js"></script>
		<!-- wow js -->
		<script src="../static/js/wow.js"></script>
		<!-- imagesloaded js -->
		<script src="../static/js/imagesloaded.pkgd.min.js"></script>
		<!-- venobox js -->
		<script src="../static/js/venobox.js"></script>
		<!--  animated-text js -->
		<script src="../static/js/animated-text.js"></script>
		<!-- venobox min js -->
		<script src="../static/js/venobox.min.js"></script>
		<!-- isotope js -->
		<script src="../static/js/isotope.pkgd.min.js"></script>
		<!-- jquery meanmenu js -->
		<script src="../static/js/jquery.meanmenu.js"></script>
		<!-- jquery scrollup js -->
		<script src="../static/js/jquery.scrollUp.js"></script>
		<script src="../static/js/jquery.barfiller.js"></script>
		<!-- jquery js -->
		<!-- theme js -->
		<script src="../static/js/theme.js"></script>
		<script>
			// 生成随机递增数据
			function generateData() {
				var data = [];
				var value = 0;
				var startDate = new Date();
				startDate.setHours(0, 0, 0, 0); // 设置起始日期为当天的凌晨
				for (var i = 0; i < 10; i++) {
					value += Math.floor(Math.random() * 5); // 生成随机数不超过5
					var date = new Date(startDate);
					date.setDate(date.getDate() + i);
					data.push([date.getTime(), value]);
				}
				return data;
			}

			// 创建静态折线图
			Highcharts.chart('chartContainer', {
				chart: {
					type: 'line'
				},
				title: {
					text: '累计上线人数'
				},
				xAxis: {
					type: 'datetime',
					tickPixelInterval: 150
				},
				yAxis: {
					title: {
						text: '人数'
					}
				},
				series: [{
					name: '累计上线人数',
					data: generateData()
				}]
			});
		</script>
		<script>
			// 随机生成递增数据
			function generateData() {
				var data = [];
				var value = 0;
				for (var i = 0; i < 10; i++) {
					value += Math.floor(Math.random() * 100);
					data.push(value);
				}
				return data;
			}

			// 创建图表
			Highcharts.chart('chartContainer1', {
				chart: {
					type: 'line'
				},
				title: {
					text: '用户操作次数'
				},
				xAxis: {
					categories: ['2023-07-01', '2023-07-02', '2023-07-03', '2023-07-04', '2023-07-05', '2023-07-06',
						'2023-07-07', '2023-07-08', '2023-07-09', '2023-07-10', '2023-07-11', '2023-07-12',
						'2023-07-13', '2023-07-14', '2023-07-15'
					]
				},
				yAxis: {
					title: {
						text: '次数'
					}
				},
				series: [{
					name: '操作次数',
					data: generateData()
				}]
			});

			// 动态更新数据
			setInterval(function() {
				var chart = Highcharts.charts[0];
				var series = chart.series[0];
				series.addPoint(Math.floor(Math.random() * 1000), true, true);
			}, 1000);
		</script>
		<script language="JavaScript">
			function generateData() {
				var data = [];
				var categories = ['本科', '硕士', '博士'];
				for (var i = 0; i < categories.length; i++) {
					var value = Math.floor(Math.random() * 100);
					data.push({
						name: categories[i],
						y: value
					});
				}
				return data;
			}

			// 创建饼图
			Highcharts.chart('chartContainer2', {
				chart: {
					type: 'pie'
				},
				title: {
					text: '用户本科、硕士、博士人数比例'
				},
				series: [{
					name: '人数',
					data: generateData()
				}]
			});
		</script>
		<script>
			function generateData() {
				var data = [];
				var categories = ['男性', '女性'];
				for (var i = 0; i < 100; i++) {
					var x = Math.floor(Math.random() * 100); // 生成0到100的随机数作为x坐标
					var y = Math.floor(Math.random() * 100); // 生成0到100的随机数作为y坐标
					var categoryIndex = Math.floor(Math.random() * categories.length); // 随机选择男性或女性
					var category = categories[categoryIndex];
					data.push({
						x: x,
						y: y,
						category: category
					});
				}
				return data;
			}

			// 创建散点图
			Highcharts.chart('chartContainer3', {
				chart: {
					type: 'scatter'
				},
				title: {
					text: '用户男性和女性数据分布'
				},
				xAxis: {
					title: {
						text: 'X轴'
					}
				},
				yAxis: {
					title: {
						text: 'Y轴'
					}
				},
				plotOptions: {
					scatter: {
						marker: {
							radius: 5,
							symbol: 'circle',
							// 设置不同性别点的不同颜色
							fillColor: {
								linearGradient: {
									x1: 0,
									y1: 0,
									x2: 1,
									y2: 1
								},
								stops: [
									[0, 'red'], // 男性点的颜色
									[1, 'green'] // 女性点的颜色
								]
							}
						}
					}
				},
				series: [{
					name: '数据',
					data: generateData()
				}]
			});
		</script>
		<script>
			window.onload = function() {
				var data = {
					"current": 0,
					"endTime": "",
					"isDelete": 0,
					"isReview": 0,
					"keywords": "",
					"size": 0,
					"startTime": "",
					"status": 0,
					"type": 0
				};
				var id1 = 0;
				var id2 = 0;
				var matchList2 = [];
				$("#exit").click(function() {
					window.location.href = "{{ url_for('login') }}";
				})

				function getResumeList() {
					var dataList = [];
					$.ajax({
						url: "/api/resumes/admin/list",
						type: "POST",
						data: JSON.stringify(data),
						dataType: "json",
						contentType: "application/json;charset=utf-8",
						success: function(response) {
							console.log(response);
							if (response['flag'] == true) {
								dataList = response['data']['recordList'];
								var box = $("#box");
								box.empty(); // 清空 #resumeList 元素的内容
								box.append("");
								for (var i = 0; i < dataList.length; i++) {
									var tr = $("<tr>");
									var species = dataList[i].filename;
									var id = dataList[i].id;
									var path = dataList[i].path;
									var type = dataList[i].type;
									if (!species.endsWith(".pdf"))
										species = species + ".txt";
									var listItem1 = $("<td>").text(id);
									var listItem2 = $("<td>").text(species);
									var listItem3 = $("<td>").text(path);
									var listItem4 = $("<td>").text(type);
									tr.append(listItem1); // 将当前元素添加到 #resumeList 元素中
									tr.append(listItem2);
									tr.append(listItem3);
									tr.append(listItem4);
									box.append(tr);
								}
								console.log(dataList);
							} else
								alert(response['message']);
						}
					})

				}
				var data = {
					"current": 0,
					"endTime": "",
					"isDelete": 0,
					"isReview": 0,
					"keywords": "",
					"size": 0,
					"startTime": "",
					"status": 0,
					"type": 0
				};
				var id1 = 0;
				var id2 = 0;
				var matchList2 = [];

				function getUserList() {
					var dataList = [];
					$.ajax({
						url: "/api/admin/users",
						type: "GET",
						data: JSON.stringify(data),
						dataType: "json",
						contentType: "application/json;charset=utf-8",
						success: function(response) {
							console.log(response);
							if (response['flag'] == true) {
								dataList = response['data']['recordList'];

								function formatDateTime(dateTimeString) {
									const date = new Date(dateTimeString);

									const year = date.getFullYear();
									const month = String(date.getMonth() + 1);
									const day = String(date.getDate());

									const hours = String(date.getHours());
									const minutes = String(date.getMinutes());
									const seconds = String(date.getSeconds());

									return `${year}/${month}/${day} ${hours}:${minutes}:${seconds}`;
								}

								var box = $("#wrap");
								box.empty(); // 清空 #resumeList 元素的内容
								box.append("");
								var roleList = [];
								$.ajax({
									url: "/api/admin/users/online",
									type: "GET",
									contentType: "application/json;charset=utf-8",
									success: function(response) {
										if (response['flag'] == true) {
											recordList = response['data']['recordList']
											console.log(recordList);
											for (var k = 0; k < recordList.length; k++) {
												roleList.push(recordList[k]['userInfoId'])
											}
											for (var i = 0; i < dataList.length; i++) {
												var tr = $("<tr>");
												var id = dataList[i].userInfoId;
												var statusCheckbox = $("<input>").attr("type",
													"checkbox");

												console.log(roleList);
												if (roleList.includes(id)) {
													console.log(typeof id);
													statusCheckbox.prop("checked",
														true); // 根据数据的值设置复选框的选中状态
												} else {
													console.log(typeof id);
													statusCheckbox.prop("checked",
														false); // 根据数据的值设置复选框的选中状态
												}
												var nickname = dataList[i].nickname;
												var roles = ["管理员", "用户"];
												var role = dataList[i].roleList[0].roleName;
												var ipAddress = dataList[i].ipAddress;
												var createTime = dataList[i].createTime;
												createTime = formatDateTime(createTime);
												var lastLoginTime = dataList[i].lastLoginTime;
												lastLoginTime = formatDateTime(lastLoginTime);
												var isDisable = dataList[i].isDisable;
												var listItem1 = $("<td>").text(id);
												var listItem2 = $("<td>").text(nickname);
												var listItem3 = $("<td>");
												var selectRole = $("<select>");
												for (var j = 0; j < roles.length; j++) {
													var option = $("<option>").text(roles[j]);
													selectRole.append(option);
												}
												selectRole.val(role); // 设置下拉框的选中值
												selectRole.change((function(index) {
													return function() {
														var selectedItem = $(this)
															.val();
														console.log("选择的角色为：" +
															selectedItem);
														console.log("整行数据：" +
															dataList[index]
															.nickname);
													}
												})(i));
												listItem3.append(selectRole);
												var listItem4 = $("<td>").text(ipAddress);
												var listItem6 = $("<td>").text(createTime);
												var listItem7 = $("<td>").text(lastLoginTime);
												var listItem8 = $("<td>");
												var disableCheckbox = $("<input>").attr("type",
													"checkbox");
												disableCheckbox.prop("checked",
													isDisable); // 根据数据的值设置复选框的选中状态
												disableCheckbox.change((function(index) {
													return function() {
														var isChecked = $(this).prop("checked");
														console.log("disableCheckbox 状态改变为：" + isChecked);
														console.log("整行数据：" + dataList[index].userInfoId);
														if (isChecked == true){
														url = "/api/admin/users/" + dataList[index].userInfoId + "/online";
														$.ajax({
															url: url,
															type: "DELETE",
															contentType: "application/json;charset=utf-8",
															success: function(response) {
																if (response['flag'] == true) {
																	alert(response['message']);
																	window.location.href = "{{ url_for('manage') }}";
																}
															}
														})
										}
													}
												})(i));
												var listItem9 = $("<td>");
												listItem8.append(disableCheckbox);
												listItem9.append(statusCheckbox);
												tr.append(listItem1); // 将当前元素添加到 #resumeList 元素中
												tr.append(listItem2);
												tr.append(listItem3);
												tr.append(listItem4);
												tr.append(listItem6);
												tr.append(listItem7);
												tr.append(listItem8);
												tr.append(listItem9);
												box.append(tr);

											}
											console.log(dataList);
										}
									}

								})

							} else
								alert(response['message']);
						}
					})
				}
				$(document).ready(function() {
					getResumeList();
					getUserList();
				})
			}
		</script>
	</body>
</html>